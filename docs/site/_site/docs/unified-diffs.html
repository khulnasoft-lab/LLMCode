

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
.site-nav ul li a {
  background-image: none;
}

  </style>

  

  
    <script src="/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Unified diffs make GPT-4 Turbo 3X less lazy | llmcode</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Unified diffs make GPT-4 Turbo 3X less lazy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="GPT-4 Turbo has a problem with lazy coding, which can be signiciantly improved by asking for code changes formatted as unified diffs." />
<meta property="og:description" content="GPT-4 Turbo has a problem with lazy coding, which can be signiciantly improved by asking for code changes formatted as unified diffs." />
<link rel="canonical" href="http://0.0.0.0:4000/docs/unified-diffs.html" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/unified-diffs.html" />
<meta property="og:site_name" content="llmcode" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Unified diffs make GPT-4 Turbo 3X less lazy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"GPT-4 Turbo has a problem with lazy coding, which can be signiciantly improved by asking for code changes formatted as unified diffs.","headline":"Unified diffs make GPT-4 Turbo 3X less lazy","url":"http://0.0.0.0:4000/docs/unified-diffs.html"}</script>
<!-- End Jekyll SEO tag -->


  
<meta property="og:image" content="http://0.0.0.0:4000/assets/benchmarks-udiff.jpg">
<meta property="twitter:image" content="http://0.0.0.0:4000/assets/benchmarks-udiff.jpg">

<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="http://0.0.0.0:4000/feed.xml">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#157878">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
<link rel="manifest" href="/assets/icons/site.webmanifest">
<link rel="mask-icon" href="/assets/icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">




</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/" class="site-title lh-tight">
  llmcode

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Installation category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/install.html" class="nav-list-link">Installation</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/install/optional.html" class="nav-list-link">Optional steps</a></li><li class="nav-list-item"><a href="/docs/install/docker.html" class="nav-list-link">Llmcode with docker</a></li><li class="nav-list-item"><a href="/docs/install/codespaces.html" class="nav-list-link">GitHub Codespaces</a></li><li class="nav-list-item"><a href="/docs/install/replit.html" class="nav-list-link">Replit</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Usage category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/usage.html" class="nav-list-link">Usage</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/usage/tips.html" class="nav-list-link">Tips</a></li><li class="nav-list-item"><a href="/docs/usage/commands.html" class="nav-list-link">In-chat commands</a></li><li class="nav-list-item"><a href="/docs/usage/modes.html" class="nav-list-link">Chat modes</a></li><li class="nav-list-item"><a href="/docs/usage/tutorials.html" class="nav-list-link">Tutorial videos</a></li><li class="nav-list-item"><a href="/docs/usage/voice.html" class="nav-list-link">Voice-to-code with llmcode</a></li><li class="nav-list-item"><a href="/docs/usage/images-urls.html" class="nav-list-link">Images &amp; web pages</a></li><li class="nav-list-item"><a href="/docs/usage/caching.html" class="nav-list-link">Prompt caching</a></li><li class="nav-list-item"><a href="/docs/usage/watch.html" class="nav-list-link">Llmcode in your IDE</a></li><li class="nav-list-item"><a href="/docs/usage/browser.html" class="nav-list-link">Llmcode in your browser</a></li><li class="nav-list-item"><a href="/docs/usage/conventions.html" class="nav-list-link">Specifying coding conventions</a></li><li class="nav-list-item"><a href="/docs/usage/copypaste.html" class="nav-list-link">Copy/paste with web chat</a></li><li class="nav-list-item"><a href="/docs/usage/lint-test.html" class="nav-list-link">Linting and testing</a></li><li class="nav-list-item"><a href="/docs/usage/not-code.html" class="nav-list-link">Editing config &amp; text files</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Connecting to LLMs category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/llms.html" class="nav-list-link">Connecting to LLMs</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/llms/openai.html" class="nav-list-link">OpenAI</a></li><li class="nav-list-item"><a href="/docs/llms/anthropic.html" class="nav-list-link">Anthropic</a></li><li class="nav-list-item"><a href="/docs/llms/gemini.html" class="nav-list-link">Gemini</a></li><li class="nav-list-item"><a href="/docs/llms/groq.html" class="nav-list-link">GROQ</a></li><li class="nav-list-item"><a href="/docs/llms/lm-studio.html" class="nav-list-link">LM Studio</a></li><li class="nav-list-item"><a href="/docs/llms/xai.html" class="nav-list-link">xAI</a></li><li class="nav-list-item"><a href="/docs/llms/azure.html" class="nav-list-link">Azure</a></li><li class="nav-list-item"><a href="/docs/llms/cohere.html" class="nav-list-link">Cohere</a></li><li class="nav-list-item"><a href="/docs/llms/deepseek.html" class="nav-list-link">DeepSeek</a></li><li class="nav-list-item"><a href="/docs/llms/ollama.html" class="nav-list-link">Ollama</a></li><li class="nav-list-item"><a href="/docs/llms/openai-compat.html" class="nav-list-link">OpenAI compatible APIs</a></li><li class="nav-list-item"><a href="/docs/llms/openrouter.html" class="nav-list-link">OpenRouter</a></li><li class="nav-list-item"><a href="/docs/llms/vertex.html" class="nav-list-link">Vertex AI</a></li><li class="nav-list-item"><a href="/docs/llms/bedrock.html" class="nav-list-link">Amazon Bedrock</a></li><li class="nav-list-item"><a href="/docs/llms/other.html" class="nav-list-link">Other LLMs</a></li><li class="nav-list-item"><a href="/docs/llms/warnings.html" class="nav-list-link">Model warnings</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Configuration category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/config.html" class="nav-list-link">Configuration</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/config/api-keys.html" class="nav-list-link">API Keys</a></li><li class="nav-list-item"><a href="/docs/config/options.html" class="nav-list-link">Options reference</a></li><li class="nav-list-item"><a href="/docs/config/llmcode_conf.html" class="nav-list-link">YAML config file</a></li><li class="nav-list-item"><a href="/docs/config/dotenv.html" class="nav-list-link">Config with .env</a></li><li class="nav-list-item"><a href="/docs/config/editor.html" class="nav-list-link">Editor configuration</a></li><li class="nav-list-item"><a href="/docs/config/reasoning.html" class="nav-list-link">Reasoning models</a></li><li class="nav-list-item"><a href="/docs/config/adv-model-settings.html" class="nav-list-link">Advanced model settings</a></li><li class="nav-list-item"><a href="/docs/config/model-aliases.html" class="nav-list-link">Model Aliases</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Troubleshooting category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/troubleshooting.html" class="nav-list-link">Troubleshooting</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/troubleshooting/edit-errors.html" class="nav-list-link">File editing problems</a></li><li class="nav-list-item"><a href="/docs/troubleshooting/warnings.html" class="nav-list-link">Model warnings</a></li><li class="nav-list-item"><a href="/docs/troubleshooting/token-limits.html" class="nav-list-link">Token limits</a></li><li class="nav-list-item"><a href="/docs/troubleshooting/imports.html" class="nav-list-link">Dependency versions</a></li><li class="nav-list-item"><a href="/docs/troubleshooting/llmcode-not-found.html" class="nav-list-link">Llmcode not found</a></li><li class="nav-list-item"><a href="/docs/troubleshooting/models-and-keys.html" class="nav-list-link">Models and API keys</a></li><li class="nav-list-item"><a href="/docs/troubleshooting/support.html" class="nav-list-link">Using /help</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Example chat transcripts category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/examples/README.html" class="nav-list-link">Example chat transcripts</a><ul class="nav-list"><li class="nav-list-item"><a href="/examples/hello-world-flask.html" class="nav-list-link">Create a simple flask app with llmcode</a></li><li class="nav-list-item"><a href="/examples/2048-game.html" class="nav-list-link">Modify an open source 2048 game with llmcode</a></li><li class="nav-list-item"><a href="/examples/complex-change.html" class="nav-list-link">A complex multi-file change, with debugging</a></li><li class="nav-list-item"><a href="/examples/add-test.html" class="nav-list-link">Create a “black box” test case</a></li><li class="nav-list-item"><a href="/examples/update-docs.html" class="nav-list-link">Automatically update docs with llmcode</a></li><li class="nav-list-item"><a href="/examples/pong.html" class="nav-list-link">Build pong with llmcode and pygame.</a></li><li class="nav-list-item"><a href="/examples/css-exercises.html" class="nav-list-link">Complete a css exercise with llmcode</a></li><li class="nav-list-item"><a href="/examples/census.html" class="nav-list-link">Download, analyze and plot US Census data</a></li><li class="nav-list-item"><a href="/examples/asciinema.html" class="nav-list-link">Editing an asciinema cast file with llmcode</a></li><li class="nav-list-item"><a href="/examples/hello.html" class="nav-list-link">Hello llmcode!</a></li><li class="nav-list-item"><a href="/examples/no-color.html" class="nav-list-link">Honor the NO_COLOR environment variable</a></li><li class="nav-list-item"><a href="/examples/chat-transcript-css.html" class="nav-list-link">Improve css styling of chat transcripts</a></li><li class="nav-list-item"><a href="/examples/semantic-search-replace.html" class="nav-list-link">Semantic search &amp; replace code with llmcode</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in More info category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/more-info.html" class="nav-list-link">More info</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/git.html" class="nav-list-link">Git integration</a></li><li class="nav-list-item"><a href="/docs/languages.html" class="nav-list-link">Supported languages</a></li><li class="nav-list-item"><a href="/docs/repomap.html" class="nav-list-link">Repository map</a></li><li class="nav-list-item"><a href="/docs/scripting.html" class="nav-list-link">Scripting llmcode</a></li><li class="nav-list-item"><a href="/docs/more/infinite-output.html" class="nav-list-link">Infinite output</a></li><li class="nav-list-item"><a href="/docs/more/edit-formats.html" class="nav-list-link">Edit formats</a></li><li class="nav-list-item"><a href="/docs/more/analytics.html" class="nav-list-link">Analytics</a></li><li class="nav-list-item"><a href="/docs/legal/privacy.html" class="nav-list-link">Privacy policy</a></li></ul></li><li class="nav-list-item"><a href="/docs/faq.html" class="nav-list-link">FAQ</a></li><li class="nav-list-item"><a href="/HISTORY.html" class="nav-list-link">Release history</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Llmcode LLM Leaderboards category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/leaderboards/" class="nav-list-link">Llmcode LLM Leaderboards</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/leaderboards/edit.html" class="nav-list-link">Code editing leaderboard</a></li><li class="nav-list-item"><a href="/docs/leaderboards/refactor.html" class="nav-list-link">Refactoring leaderboard</a></li><li class="nav-list-item"><a href="/docs/leaderboards/by-release-date.html" class="nav-list-link">Scores by release date</a></li><li class="nav-list-item"><a href="/docs/leaderboards/notes.html" class="nav-list-link">Benchmark notes</a></li><li class="nav-list-item"><a href="/docs/leaderboards/contrib.html" class="nav-list-link">Contributing results</a></li></ul></li><li class="nav-list-item"><a href="/blog/" class="nav-list-link">Llmcode blog</a></li></ul>

  <ul class="nav-list"><li class="nav-list-item external">
          <a href="https://github.com/KhulnaSoft/llmcode" class="nav-list-link external"
            
          >
            GitHub
            <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg>
          </a>
        </li><li class="nav-list-item external">
          <a href="https://discord.gg/Tv2uQnR88V" class="nav-list-link external"
            
          >
            Discord
            <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg>
          </a>
        </li></ul>
</nav>


  
  
    <footer class="site-footer">
    Llmcode is AI pair programming in your terminal.
    Llmcode is on
    <a href="https://github.com/KhulnaSoft/llmcode">GitHub</a>
    and
    <a href="https://discord.gg/Tv2uQnR88V">Discord</a>.
</footer>

  
</div>

  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search llmcode" aria-label="Search llmcode" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/KhulnaSoft/llmcode" class="site-button"
          
        >
          GitHub
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://discord.gg/Tv2uQnR88V" class="site-button"
          
        >
          Discord
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="/blog/" class="site-button"
          
        >
          Blog
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div class="main-content-wrap">
      
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="unified-diffs-make-gpt-4-turbo-3x-less-lazy">
  
  
    <a href="#unified-diffs-make-gpt-4-turbo-3x-less-lazy" class="anchor-heading" aria-labelledby="unified-diffs-make-gpt-4-turbo-3x-less-lazy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unified diffs make GPT-4 Turbo 3X less lazy
  
  
</h1>
    

<p><img src="/assets/benchmarks-udiff.svg" alt="robot flowchart" /></p>

<p>Llmcode now asks GPT-4 Turbo to use
<a href="#choose-a-familiar-editing-format">unified diffs</a>
to edit your code.
This dramatically improves GPT-4 Turbo’s performance on a
challenging
new benchmark 
and significantly reduces its bad habit of “lazy” coding,
where it writes
code with comments
like “…add logic here…”.</p>

<p>Llmcode’s new “laziness” benchmark suite 
is designed to both provoke and quantify lazy coding.
It consists of
89 python refactoring tasks
which tend to make GPT-4 Turbo write lazy comments like
“…include original method body…”.</p>

<p>This new laziness benchmark produced the following results with <code class="language-plaintext highlighter-rouge">gpt-4-1106-preview</code>:</p>

<ul>
  <li><strong>GPT-4 Turbo only scored 20% as a baseline</strong> using llmcodede’s existing “SEARCH/REPLACE block” edit format. It outputs “lazy comments” on 12 of the tasks.</li>
  <li><strong>Llmcode’s new unified diff edit format raised the score to 61%</strong>. Using this format reduced laziness by 3X, with GPT-4 Turbo only using lazy comments on 4 of the tasks.</li>
  <li><strong>It’s worse to add a prompt that says the user is blind, has no hands, will tip $2000 and fears truncated code trauma.</strong> Widely circulated “emotional appeal” folk remedies 
produced worse benchmark scores
for both the baseline SEARCH/REPLACE and new unified diff editing formats.</li>
</ul>

<p>The older <code class="language-plaintext highlighter-rouge">gpt-4-0613</code> also did better on the laziness benchmark using unified diffs:</p>

<ul>
  <li><strong>The June GPT-4’s baseline was 26%</strong> using llmcodede’s existing “SEARCH/REPLACE block” edit format.</li>
  <li><strong>Llmcode’s new unified diff edit format raised June GPT-4’s score to 59%</strong>.</li>
  <li>The benchmark was designed to use large files, and
28% of them are too large to fit in June GPT-4’s 8k context window.
This puts a hard ceiling of 72% on how well the June model could possibly score.</li>
</ul>

<p>With unified diffs, GPT acts more like it’s writing textual data intended to be read by a program,
not talking to a person.
Diffs are
usually
consumed by the
<a href="https://www.gnu.org/software/diffutils/manual/html_node/Merging-with-patch.html">patch</a>
program, which is fairly rigid.
This seems to encourage rigor, making
GPT less likely to
leave informal editing instructions in comments
or be lazy about writing all the needed code.</p>

<p>Llmcode’s new unified diff editing format
outperforms other solutions I evaluated by a wide margin.
I explored many other approaches including:
prompts about being tireless and diligent,
OpenAI’s function/tool calling capabilities,
numerous variations on llmcodede’s existing editing formats,
line number based formats
and other diff-like formats.
The results shared here reflect
an extensive investigation and benchmark evaluations of many approaches.</p>

<p>The rest of this article will describe
llmcodede’s new editing format and refactoring benchmark.
It will highlight some key design decisions,
and evaluate their significance using ablation experiments.</p>
<h2 id="unified-diff-editing-format">
  
  
    <a href="#unified-diff-editing-format" class="anchor-heading" aria-labelledby="unified-diff-editing-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unified diff editing format
  
  
</h2>
    

<p>The design and implementation of llmcodede’s new unified diff editing format
helped clarify some general principles
for GPT-4 code editing:</p>

<ul>
  <li>FAMILIAR - Choose an edit format that GPT is already familiar with.</li>
  <li>SIMPLE - Choose a simple format that avoids escaping, syntactic overhead and brittle specifiers like line numbers or line counts.</li>
  <li>HIGH LEVEL - Encourage GPT to structure edits as new versions of substantive code blocks (functions, methods, etc), not as a series of surgical/minimal changes to individual lines of code.</li>
  <li>FLEXIBLE - Strive to be maximally flexible when interpreting GPT’s edit instructions.</li>
</ul>

<p>A helpful shortcut here is to have empathy for GPT, and imagine you
are the one being asked to specify code edits.
Would you want to hand type a properly escaped json data structure
to invoke surgical insert, delete, replace operations on specific code line numbers?
Do you want to use a brittle format, where any mistake
causes an error that discards all your work?</p>

<p>GPT is quantitatively better at code editing when you reduce the
burden of formatting edits by using a familiar, simple, high level
and flexible editing format.</p>
<h3 id="choose-a-familiar-editing-format">
  
  
    <a href="#choose-a-familiar-editing-format" class="anchor-heading" aria-labelledby="choose-a-familiar-editing-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Choose a familiar editing format
  
  
</h3>
    

<p>Unified diffs are perhaps the most common way to show
code edits, because it’s the 
default output format of <code class="language-plaintext highlighter-rouge">git diff</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/greeting.py
</span><span class="gi">+++ b/greeting.py
</span><span class="p">@@ -1,5 +1,5 @@</span>
 def main(args):
     # show a greeting
<span class="gd">-    print("Hello!")
</span><span class="gi">+    print("Goodbye!")
</span>     return
</code></pre></div></div>

<p>Choosing such a popular format means that GPT has
seen <em>many</em> examples in its training data.
It’s been trained to generate
text that conforms to the unified diff syntax.</p>
<h3 id="use-a-simple-editing-format">
  
  
    <a href="#use-a-simple-editing-format" class="anchor-heading" aria-labelledby="use-a-simple-editing-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use a simple editing format
  
  
</h3>
    

<p>Llmcode’s <a href="https://llmcodede.chat/docs/benchmarks.html">previous benchmark results</a> made
it clear that simple editing formats
work best.
Even though OpenAI provides extensive support for
structured formats like json and function calls,
GPT is worse at editing code if you use them.
I repeated these and other similar benchmarks against GPT-4 Turbo,
and again reached these same conclusions.</p>

<p>Informally, this is probably because stuffing <em>source code</em> into JSON is complicated
and error prone.
Wrapping the python code
<code class="language-plaintext highlighter-rouge">print("On Windows use \"C:\\\"")</code>
as valid json is pretty painful and error prone.
Due to escaping issues GPT’s code is often syntactically incorrect when it’s
unpacked from JSON,
or the JSON decode just fails entirely.</p>

<p>On the other hand, the core of the unified diff format is very simple.
You include a hunk of the file that needs to be changed,
with every line prefixed by a character
to indicate unchanged, new or deleted lines.
A unified diff looks pretty much like the code it is modifying.</p>

<p>The one complicated piece is the line numbers found at the start
of each hunk. They look something like this: <code class="language-plaintext highlighter-rouge">@@ -2,4 +3,5 @@</code>.
GPT is terrible at working with source code line numbers.
This is a general observation about <em>any</em> use of line
numbers in editing formats,
backed up by many quantitative benchmark experiments.</p>

<p>You’ve probably ignored the line numbers in every diff you’ve seen,
because the diffs usually still make sense without them.
Llmcode tells GPT not to include line numbers,
and just interprets each hunk from the unified diffs
as a search and replace operation:</p>

<p>This diff:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@@ ... @@</span>
 def main(args):
     # show a greeting
<span class="gd">-    print("Hello!")
</span><span class="gi">+    print("Goodbye!")
</span>     return
</code></pre></div></div>

<p>Means we need to search the file for the
<em>space</em> and <em>minus</em> <code class="language-plaintext highlighter-rouge">-</code> lines:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># show a greeting
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Hello!"</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></div>

<p>And replace them with the <em>space</em> and <em>plus</em> <code class="language-plaintext highlighter-rouge">+</code> lines:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># show a greeting
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Goodbye!"</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></div>

<p>Simple, right?</p>
<h3 id="encourage-high-level-edits">
  
  
    <a href="#encourage-high-level-edits" class="anchor-heading" aria-labelledby="encourage-high-level-edits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Encourage high level edits
  
  
</h3>
    

<p>The example unified diffs we’ve seen so far have all been single line changes,
which makes them pretty easy to read and understand.
Consider this slightly more complex change, which renames the variable <code class="language-plaintext highlighter-rouge">n</code> to
<code class="language-plaintext highlighter-rouge">number</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@@ ... @@</span>
<span class="gd">-def factorial(n):
</span><span class="gi">+def factorial(number):
</span><span class="gd">-    if n == 0:
</span><span class="gi">+    if number == 0:
</span>         return 1
     else:
<span class="gd">-        return n * factorial(n-1)
</span><span class="gi">+        return number * factorial(number-1)
</span></code></pre></div></div>

<p>The following “high level diff” of the same
change is not as succinct as the minimal diff above,
but it is much easier to see two different coherent versions of the
<code class="language-plaintext highlighter-rouge">factorial()</code> function.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@@ ... @@</span>
<span class="gd">-def factorial(n):
-    if n == 0:
-        return 1
-    else:
-        return n * factorial(n-1)
</span><span class="gi">+def factorial(number):
+    if number == 0:
+        return 1
+    else:
+        return number * factorial(number-1)
</span></code></pre></div></div>

<p>Llmcode’s system prompt encourages
GPT to produce these high level diffs.
This makes GPT better at producing correct diffs, which can be successfully
applied to the original file.</p>

<p><strong>Experiments without “high level diff” prompting
produce a 30-50% increase in editing errors,</strong>
where diffs fail to apply or apply incorrectly and
produce invalid code.
When a patch fails, llmcodede needs to ask GPT for a corrected version of the diff.
This takes time, costs tokens and sometimes fails to produce a successful edit
even after multiple retries.</p>

<p>There are probably a couple of reasons why high level diffs
help:</p>

<ul>
  <li>It’s easier to produce diffs that both correctly match the original code and correctly produce the intended new code. There is less risk of GPT getting confused, compared to generating a series of surgical edits that interleave lines of old and new code.</li>
  <li>High level hunks often contain more lines than a surgical hunk, so they are less likely to accidentally match unrelated parts of the code. This is helpful because GPT can’t reliably give us line numbers to specify exactly where in the file to make changes.</li>
</ul>
<h3 id="be-flexible-when-applying-edits">
  
  
    <a href="#be-flexible-when-applying-edits" class="anchor-heading" aria-labelledby="be-flexible-when-applying-edits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Be flexible when applying edits
  
  
</h3>
    

<p>GPT frequently makes imperfect diffs that won’t apply cleanly.
They exhibit a variety of problems:</p>

<ul>
  <li>GPT forgets things like comments, docstrings, blank lines, etc. Or it skips over some code that it doesn’t intend to change.</li>
  <li>GPT forgets the leading <em>plus</em> <code class="language-plaintext highlighter-rouge">+</code> character to mark novel lines that it wants to add to the file. It incorrectly includes them with a leading <em>space</em> as if they were already there.</li>
  <li>GPT outdents all of the code, removing all the leading white space which is shared across the lines. So a chunk of deeply indented code is shown in a diff with only the leading white space that changes between the lines in the chunk.</li>
  <li>GPT jumps ahead to show edits to a different part of the file without starting a new hunk with a <code class="language-plaintext highlighter-rouge">@@ ... @@</code> divider.</li>
</ul>

<p>As an example of the first issue, consider this source code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># show a greeting
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Hello!"</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</code></pre></div></div>

<p><strong>The diff below is missing the “show a greeting” comment line</strong>,
and represents a common type of mistake GPT might make.
When we search for the <em>minus</em> <code class="language-plaintext highlighter-rouge">-</code> lines, we won’t find them
in the original file
because of the missing comment.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@@ ... @@</span>
<span class="gd">-def main(args):
-    print("Hello!")
-    return
</span><span class="gi">+def main(args):
+    print("Goodbye!")
+    return
</span></code></pre></div></div>

<p>Llmcode tries to be very flexible when applying diffs,
in order to handle defects.
If a hunk doesn’t apply cleanly, llmcodede uses a number of strategies:</p>

<ul>
  <li>Normalize the hunk, by taking the <em>minus</em> <code class="language-plaintext highlighter-rouge">-</code> and <em>space</em> lines as one version of the hunk and the <em>space</em> and <em>plus</em> <code class="language-plaintext highlighter-rouge">+</code> lines as a second version and doing an actual unified diff on them.</li>
  <li>Try and discover new lines that GPT is trying to add but which it forgot to mark with <em>plus</em> <code class="language-plaintext highlighter-rouge">+</code> markers. This is done by diffing the <em>minus</em> <code class="language-plaintext highlighter-rouge">-</code> and <em>space</em> lines back against the original file.</li>
  <li>Try and apply the hunk using “relative leading white space”, so we can match and patch correctly even if the hunk has been uniformly indented or outdented.</li>
  <li>Break a large hunk apart into an overlapping sequence of smaller hunks, which each contain only one contiguous run of <em>plus</em> <code class="language-plaintext highlighter-rouge">+</code> and <em>minus</em> <code class="language-plaintext highlighter-rouge">-</code> lines. Try and apply each of these sub-hunks independently.</li>
  <li>Vary the size and offset of the “context window” of <em>space</em>  lines from the hunk that are used to localize the edit to a specific part of the file.</li>
  <li>Combine the above mechanisms to progressively become more permissive about how to apply the hunk.</li>
</ul>

<p>These flexible patching strategies are critical, and 
removing them
radically increases the number of hunks which fail to apply.
<strong>Experiments where flexible patching is disabled show a 9X increase in editing errors</strong> on llmcodede’s original Exercism benchmark.</p>
<h2 id="refactoring-benchmark">
  
  
    <a href="#refactoring-benchmark" class="anchor-heading" aria-labelledby="refactoring-benchmark"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Refactoring benchmark
  
  
</h2>
    

<p>Llmcode has long used a
<a href="https://llmcodede.chat/2023/07/02/benchmarks.html">benchmark suite based on 133 Exercism python exercises</a>.
But these are mostly small coding problems,
usually requiring only a few dozen lines of code.
GPT-4 Turbo is typically only lazy on 2-3 of these exercises:
the ones with the most code and which involve refactoring.</p>

<p>Based on this observation, I set out to build a benchmark based on refactoring
a non-trivial amount of code found in fairly large files.
To do this, I used python’s <code class="language-plaintext highlighter-rouge">ast</code> module to analyze
<a href="https://github.com/Llmcode-AI/refactor-benchmark">9 popular open source python repositories</a>
to identify challenging refactoring tasks.
The goal was to find:</p>

<ul>
  <li>Source files that contain classes with non-trivial methods, having 100-250+ AST nodes in their implementation.</li>
  <li>Focus on methods that are part of a larger class, which has at least twice as much code as the method itself.</li>
  <li>Select methods that don’t use their <code class="language-plaintext highlighter-rouge">self</code> parameter, so they can be trivially refactored out of the class.</li>
</ul>

<p>We can then turn each of these source files into a task for the benchmark,
where we ask GPT to do something like:</p>

<blockquote>
  <p>Refactor the <code class="language-plaintext highlighter-rouge">_set_csrf_cookie</code> method in the <code class="language-plaintext highlighter-rouge">CsrfViewMiddleware</code> class to be a stand alone, top level function.
Name the new function <code class="language-plaintext highlighter-rouge">_set_csrf_cookie</code>, exactly the same name as the existing method.
Update any existing <code class="language-plaintext highlighter-rouge">self._set_csrf_cookie</code> calls to work with the new <code class="language-plaintext highlighter-rouge">_set_csrf_cookie</code> function.</p>
</blockquote>

<p>A <a href="https://github.com/KhulnaSoft/llmcode/blob/main/benchmark/refactor_tools.py">simple python AST scanning script</a>
found 89 suitable files
and packaged them up as benchmark tasks.
Each task has a test
that checks if the refactor
was performed roughly correctly:</p>

<ul>
  <li>The updated source file must parse as valid python, to detect misapplied edits which produce invalid code.</li>
  <li>The target method must now exist as a top-level function in the file.</li>
  <li>This new top-level function must contain approximately the same number of AST nodes as the original class method. This ensures that GPT didn’t elide code and replace it with comments.</li>
  <li>The original class must still be present in the file, and it must be smaller by about the number of AST nodes in the method which was removed. This helps confirm that the method was removed from the class, without other significant modifications.</li>
</ul>

<p>To be clear, this is not a rigorous test that the refactor was performed correctly.
But it does serve as a basic sanity check that the refactor was essentially done as a cut &amp; paste, without eliding any code as comments.
And it correlates well with other laziness metrics
gathered during benchmarking like the
introduction of new comments that contain “…”.</p>

<p>The result is a pragmatic
<a href="https://github.com/LlmcodeI/refactor-benchmark">benchmark suite that provokes, detects and quantifies GPT coding laziness</a>.</p>
<h2 id="conclusions-and-future-work">
  
  
    <a href="#conclusions-and-future-work" class="anchor-heading" aria-labelledby="conclusions-and-future-work"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conclusions and future work
  
  
</h2>
    

<p>Based on the refactor benchmark results,
llmcodede’s new unified diff format seems
to dramatically increase GPT-4 Turbo’s skill at more complex coding tasks.
It also seems very effective at reducing the lazy coding
which has been widely noted as a problem with GPT-4 Turbo.</p>

<p>Unified diffs was one of the very first edit formats I tried
when originally building llmcodede.
I think a lot of other AI coding assistant projects have also
tried going down this path.
It seems like any naive or direct use of structured diff formats
is pretty much doomed to failure.
But the techniques described here and
incorporated into llmcodede provide
a highly effective way to harness GPT’s knowledge of unified diffs.</p>

<p>There could be significant benefits to
fine tuning models on
llmcodede’s simple, high level style of unified diffs.
Dropping line numbers from the hunk headers and focusing on diffs of
semantically coherent chunks of code
seems to be an important part of successful GPT code editing
(besides the relentless focus on flexibly applying edits).
Most LLMs will have already seen plenty of unified diffs
in their normal training data, and so should be
amenable to fining tuning towards this
particular diff style.</p>

          

          
        </main>
        


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
</body>
</html>

